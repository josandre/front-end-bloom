<section class="content">
  <div *ngIf="medicalRecord != null && patient != null;">
    <div class="content-block">
      <div class="block-header">
        <!-- breadcrumb -->
        <app-breadcrumb [title]="'Profile'" [items]="['Extra']" [active_item]="'Profile'"></app-breadcrumb>
      </div>
      <!-- Your content goes here  -->
      <div class="row clearfix">
        <div class="col-lg-4 col-md-12">
          <div class="card">
            <div class="m-b-20">
              <div class="contact-grid">
                <div class="profile-header bg-blue pt-3">
                  <div class="user-name">{{ patient.name }} {{ patient.lastName }}</div>
                  <div class="name-center">{{ patient.email }}</div>
                </div>
                <img src="assets/images/user/usrbig3.jpg" class="user-img" alt="">
                <p>
                  {{ patient.address }}
                </p>
                <div>
                  <span class="phone">
                    <i class="material-icons">phone</i>{{ patient.phone }}</span>
                </div>
              </div>
            </div>
          </div>


          <div class="card">
            <mat-tab-group mat-align-tabs="start">

              <!-- Family medical record -->
              <mat-tab label="Family Medical History">
                <div class="p-4">
                  <form class="example-form validate-form">
                    <mat-form-field class="example-full-width" appearance="fill">
                      <textarea matInput [formControl]="familyMedicalHistoryControl" cdkTextareaAutosize
                        #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"></textarea>
                    </mat-form-field>
                    <div class="example-button-container">
                      <button mat-mini-fab color="primary"
                        (click)="familyMedicalHistoryControl.enable()"><mat-icon>edit</mat-icon></button>
                      <button mat-raised-button *ngIf="isFormEnabled(familyMedicalHistoryControl)"
                        (click)="updateMedicalRecord()">Save</button>
                    </div>
                  </form>
                </div>
              </mat-tab>

              <!-- Anxieties -->
              <mat-tab label="Anxieties">
                <div class="p-4">
                  <form>
                    <mat-form-field class="example-chip-list" appearance="fill">
                      <mat-label>{{ patient.name }}'s anxieties</mat-label>
                      <mat-chip-list #chipList aria-label="anxieties" multiple [formControl]="anxitiesControl">
                        <mat-chip *ngFor="let anxiety of anxieties" [selected]="anxiety" [value]="anxiety"
                          (removed)="removeAnxietyType(anxiety)">
                          {{ anxiety }}
                        </mat-chip>
                        <input placeholder="New anxiety type..." [matChipInputFor]="chipList"
                          (matChipInputTokenEnd)="addAnxietyTypeFromInput($event)">
                      </mat-chip-list>
                    </mat-form-field>
                    <div class="example-button-container">
                      <button mat-mini-fab color="primary"
                        (click)="anxitiesControl.enable()"><mat-icon>edit</mat-icon></button>
                      <button mat-raised-button *ngIf="isFormEnabled(anxitiesControl)"
                        (click)="anxitiesControl.disable()">Quit</button>
                    </div>
                  </form>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
          <p class="font-italic text-muted">
            Updated {{ medicalRecord.lastUpdate| date:'medium' }}
          </p>
        </div>
        <div class="col-lg-8 col-md-12">
          <div class="card">
            <mat-tab-group>
              <mat-tab>
                <ng-template mat-tab-label>
                  <mat-icon class="example-tab-icon msr-2">folder</mat-icon>
                  Medical History

                </ng-template>


                <div>
                  <mat-paginator [pageSize]="pageSize" [length]="medicalHistories?.length"
                    (page)="currentPage = $event.pageIndex + 1">
                  </mat-paginator>
                </div>





                <div *ngFor="let medicalHistory of paginatedItems">
                  <ng-container>
                    <mat-accordion class="w-100">
                      <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <div class="header">
                              <h2><strong>Appointment Date</strong></h2>
                            </div>
                          </mat-panel-title>
                          <mat-panel-description>
                            {{ medicalHistory.creationDate | date:'fullDate' }}
                          </mat-panel-description>
                        </mat-expansion-panel-header>
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <div class="project_widget">
                            <div class="header">
                              <h2><strong>Notes</strong></h2>
                            </div>
                            <div class="body">
                              <ul>
                                <li><strong>Anxiety level:</strong> {{ medicalHistory.anxietyLevel }}</li>
                                <li><strong>Observations:</strong> {{ medicalHistory.observations }}</li>
                                <li><strong>Treatment started on:</strong> {{ medicalHistory.treatmentEndDate |
                                  date:'fullDate' }}</li>
                                <li><strong>Treatment ended on:</strong> {{ medicalHistory.treatmentEndDate |
                                  date:'fullDate' }}</li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <div class="project_widget">
                            <div class="header">
                              <h2><strong>Recipe</strong></h2>
                            </div>
                            <div class="body">
                              <ul>
                                <li><strong>Name:</strong> {{ medicalHistory.medicalRecipe.name }}</li>
                                <li><strong>Indications:</strong> {{ medicalHistory.medicalRecipe.indications }}
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </ng-container>
                </div>
                <ng-container class="no-results" *ngIf="medicalHistories?.length == 0">
                  <div class="pt-5 px-3 py-md-3">
                    <p class="text-muted">No appointments registered.</p>
                  </div>
                </ng-container>
              </mat-tab>
            </mat-tab-group>
            <div class="m-l-10 p-3">
              <button mat-mini-fab color="primary" class="right">
                <mat-icon class="col-white">add</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="center" *ngIf="medicalRecord == null && patient == null">
    <mat-spinner></mat-spinner>
  </div>
</section>